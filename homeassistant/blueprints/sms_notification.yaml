blueprint:
  name: çŸ­ä¿¡è½¬å‘å™¨ - æ”¶åˆ°çŸ­ä¿¡é€šçŸ¥
  description: å½“çŸ­ä¿¡è½¬å‘å™¨æ”¶åˆ°æ–°çŸ­ä¿¡æ—¶ï¼Œè½¬å‘é€šçŸ¥åˆ°æ‰‹æœºæˆ–å…¶ä»–è®¾å¤‡
  domain: automation
  
  input:
    sms_content_entity:
      name: çŸ­ä¿¡å†…å®¹ä¼ æ„Ÿå™¨
      description: é€‰æ‹©çŸ­ä¿¡è½¬å‘å™¨çš„"æœ€è¿‘çŸ­ä¿¡å†…å®¹"ä¼ æ„Ÿå™¨
      selector:
        entity:
          domain: sensor
    
    notify_service:
      name: é€šçŸ¥æœåŠ¡
      description: é€‰æ‹©è¦å‘é€é€šçŸ¥çš„æœåŠ¡ï¼ˆå¦‚ notify.mobile_app_xxxï¼‰
      selector:
        select:
          options:
            - notify.mobile_app_iphone
            - notify.persistent_notification
          custom_value: true
      default: "notify.mobile_app_iphone"
    
    filter_sender:
      name: è¿‡æ»¤å‘é€è€…ï¼ˆå¯é€‰ï¼‰
      description: åªæœ‰æŒ‡å®šå·ç å‘æ¥çš„çŸ­ä¿¡æ‰é€šçŸ¥ï¼Œç•™ç©ºåˆ™å…¨éƒ¨é€šçŸ¥ã€‚å¤šä¸ªå·ç ç”¨é€—å·åˆ†éš”
      default: ""
      selector:
        text:

variables:
  sms_entity: !input sms_content_entity
  filter_sender: !input filter_sender

trigger:
  - platform: state
    entity_id: !input sms_content_entity

condition:
  # å¿½ç•¥çŠ¶æ€å˜ä¸º unavailable/unknown çš„æƒ…å†µ
  - condition: template
    value_template: "{{ trigger.to_state.state not in ['unavailable', 'unknown', 'none', ''] }}"
  # å‘é€è€…è¿‡æ»¤
  - condition: template
    value_template: >-
      {% set sender = state_attr(sms_entity, 'sender') | default('') %}
      {% if filter_sender == '' %}
        true
      {% else %}
        {{ sender in filter_sender.split(',') }}
      {% endif %}

action:
  - variables:
      sender: "{{ state_attr(sms_entity, 'sender') | default('æœªçŸ¥') }}"
      message: "{{ state_attr(sms_entity, 'message') | default(states(sms_entity)) }}"
      time: "{{ state_attr(sms_entity, 'time') | default('') }}"
  - service: !input notify_service
    data:
      title: "ğŸ“± {{ sender }}"
      message: "{{ message }}"
      data:
        push:
          sound: default
        tag: "sms_{{ sender }}"

mode: queued
max: 10
