# 短信转发器 MQTT 传感器配置
# 
# 使用方法：
# 1. 将此内容添加到 configuration.yaml
# 2. 把 "123456" 替换成你的设备 ID（在短信转发器网页查看）
# 3. 把 "sms" 替换成你设置的主题前缀（如果有修改的话）
# 4. 重启 Home Assistant

mqtt:
  sensor:
    # 设备在线状态
    - name: "短信转发器状态"
      unique_id: sms_forwarder_status
      state_topic: "sms/123456/status"
      value_template: "{{ value_json.status }}"
      icon: mdi:message-text
      
    # WiFi 信号强度
    - name: "短信转发器 WiFi 信号"
      unique_id: sms_forwarder_wifi
      state_topic: "sms/123456/status"
      value_template: >-
        {% set rssi = value_json.wifi_rssi | int(-999) %}
        {% set status = value_json.wifi_status | default('未知') %}
        {% if rssi == -999 %}未知
        {% else %}{{ rssi }} dBm ({{ status }})
        {% endif %}
      icon: mdi:wifi
      
    # 4G 信号强度
    - name: "短信转发器 4G 信号"
      unique_id: sms_forwarder_lte
      state_topic: "sms/123456/status"
      value_template: >-
        {% set rsrp = value_json.lte_rsrp | int(-999) %}
        {% set status = value_json.lte_status | default('未知') %}
        {% if rsrp == -999 %}未知
        {% else %}{{ rsrp }} dBm ({{ status }})
        {% endif %}
      icon: mdi:signal-4g
      
    # APN
    - name: "短信转发器 APN"
      unique_id: sms_forwarder_apn
      state_topic: "sms/123456/status"
      value_template: "{{ value_json.apn | default('未知') }}"
      icon: mdi:access-point-network
      
    # 设备 IP 地址
    - name: "短信转发器 IP"
      unique_id: sms_forwarder_ip
      state_topic: "sms/123456/status"
      value_template: "{{ value_json.ip }}"
      icon: mdi:ip-network
      
    # 运行时间
    - name: "短信转发器运行时间"
      unique_id: sms_forwarder_uptime
      state_topic: "sms/123456/status"
      value_template: "{{ (value_json.uptime | int / 3600) | round(1) }}"
      unit_of_measurement: "小时"
      icon: mdi:clock-outline
      
    # 最近收到的短信 - 发送者
    - name: "最近短信发送者"
      unique_id: sms_forwarder_last_sender
      state_topic: "sms/123456/sms/received"
      value_template: "{{ value_json.sender }}"
      icon: mdi:account
      
    # 最近收到的短信 - 内容
    - name: "最近短信内容"
      unique_id: sms_forwarder_last_message
      state_topic: "sms/123456/sms/received"
      value_template: "{{ value_json.message[:200] }}"
      icon: mdi:message-text

  # 二进制传感器 - 在线状态
  binary_sensor:
    - name: "短信转发器在线"
      unique_id: sms_forwarder_online
      state_topic: "sms/123456/status"
      value_template: "{{ value_json.status }}"
      payload_on: "online"
      payload_off: "offline"
      device_class: connectivity
      icon: mdi:message-check
